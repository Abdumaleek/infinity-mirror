bootstrap: docker
from: nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04

%post
    apt-get -y update
    apt-get -y install gcc make vim wget
    apt-get -y install \
        libgl1-mesa-glx \
        libegl1-mesa \
        libxrandr2 \
        libxrandr2 \
        libxss1 \
        libxcursor1 \
        libxcomposite1 \
        libasound2 \
        libxi6 \
        libxtst6 \
        libncurses5-dev \
        zlib1g-dev
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ./miniconda.sh
    bash miniconda.sh -b -p "/opt/conda" && rm miniconda.sh
    export PATH=/opt/conda/bin:$PATH

    conda install --yes -c anaconda tensorflow==2.0.0
    conda install --yes -c conda-forge numpy
    conda install --yes -c conda-forge scipy
    conda install --yes -c conda-forge scikit-learn
    conda install --yes -c conda-forge matplotlib
    conda install --yes -c conda-forge python-igraph
    conda install --yes -c conda-forge networkx
    conda install --yes -c conda-forge numba

    conda clean --index-cache --tarballs --packages --yes

    pip install powerlaw
    pip install notebook

%environment
    export PATH="/opt/conda/bin:/usr/local/bin:/usr/bin:/bin:"
    unset CONDA_DEFAULT_ENV
    export ANACONDA_HOME=/opt/conda
